window.crossPlatformText={init:function(args,callback){var crossPlatformTextInstance=this;this.svg.crossPlatformTextInstance=this;var format,targetSelector=args.targetSelector,target=document.querySelector(targetSelector),targetTagName=target.tagName.toLowerCase(),targetSelection=d3.select(target),htmlContainerElements=["div","section","p"];htmlContainerElements.indexOf(this.targetTagName)>-1?(format=args.format,this[format].targetSelection=targetSelection,this.setFormat(format,targetTagName,targetSelection),crossPlatformTextInstance[format].init(args,function(viewport){callback&&callback(viewport)})):(format=targetTagName,this[format].targetImageSelection=targetSelection,this.setFormat(format,targetTagName,targetSelection),this[format].init(args,function(viewport){callback&&callback(viewport)}))},convertToPx:function(inputString,fontSize){var inputStringLowerCased,px;return pathvisiojs.utilities.isNumber(inputString)?px=inputString:(inputStringLowerCased=inputString.toLowerCase(),px=inputStringLowerCased.indexOf("em")>-1?inputStringLowerCased.slice(0,inputStringLowerCased.length-2)*fontSize:inputStringLowerCased.indexOf("px")>-1?inputStringLowerCased.slice(0,inputStringLowerCased.length-2):inputStringLowerCased.indexOf("pt")>-1?inputStringLowerCased.slice(0,inputStringLowerCased.length-2)*(4/3):inputStringLowerCased.indexOf("%")>-1?inputStringLowerCased.slice(0,inputStringLowerCased.length-1)/100*fontSize:inputString),px},setFormat:function(format,targetTagName){this[format].targetTagName=targetTagName,this.render=this[format].render}},crossPlatformText.svg={init:function(data,callback){var viewport;if(this.targetImageSelection)targetImageSelection=this.targetImageSelection,viewport=targetImageSelection.select("#viewport"),viewport[0][0]||(viewport=targetImageSelection.select("g"));else{var id=args.id||"cross-platform-text-svg";targetImageSelection=this.targetSelection.append("svg").attr("id",id).attr("version","1.1").attr("baseProfile","full").attr("xmlns","http://www.w3.org/1999/xlink").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").attr("xmlns:xmlns:ev","http://www.w3.org/2001/xml-events").attr("preserveAspectRatio","xMidYMid").attr("width",width).attr("height",height),viewport=targetImageSelection.append("g").attr("id","viewport")}callback&&callback(viewport)},render:function(data,callback){var attributeDependencyOrder=(this.crossPlatformTextInstance,["fontSize"]),textContentSplitIntoLines=data.textContent.split(/\r\n|\r|\n|&#xA;/g),textLineCount=textContentSplitIntoLines.length,padding=data.padding||0,width=data.width,height=data.height,fontSize=data.fontSize,paddingInPx=crossPlatformText.convertToPx(padding,fontSize);fontSize=crossPlatformText.convertToPx(fontSize,fontSize);var textAnchor;"left"===data.textAlign?(textAnchor="start",textAlignXTranslation=paddingInPx):"right"===data.textAlign?(textAnchor="end",textAlignXTranslation=width-paddingInPx):(textAnchor="middle",textAlignXTranslation=width/2);var verticalAlignYTranslation,xTranslation=data.x+textAlignXTranslation,textAreaHeight=1.1*(textLineCount-1)*fontSize;verticalAlignYTranslation="top"===data.verticalAlign?paddingInPx+textAreaHeight/2+fontSize*(2/3):"bottom"===data.verticalAlign?height-paddingInPx-textAreaHeight/2-fontSize*(2/3):height/2;var yTranslation=data.y+verticalAlignYTranslation,transform="translate("+xTranslation+" "+yTranslation+")",textAreaSelection=targetImageSelection.select(data.containerSelector).append("g").attr("transform",transform),result=(textAreaSelection.selectAll("text").data(textContentSplitIntoLines).enter().append("text").attr("id",function(d,i){return"text-line"+i}).attr("x",0).attr("y",function(d,i){return 1.1*(i-(textLineCount-1)/2)+"em"}).attr("dominant-baseline","central").attr("text-anchor",textAnchor).text(function(d){return d}),{}),attributes=[];result.elementName="g";var backgroundColor=data.backgroundColor||"transparent";attributes.push({name:"fill",value:backgroundColor});var attributeListItemName,attributeListItemValue,svgTextAttributeGenerator={color:function(colorValue){textAreaSelection.attr("fill",colorValue)},id:function(idValue){textAreaSelection.attr("id","text-for-"+idValue)},fill:function(fillValue){textAreaSelection.attr("fill",fillValue)},fillOpacity:function(fillOpacityValue){textAreaSelection.attr("fill-opacity",fillOpacityValue)},fontFamily:function(fontFamilyValue){textAreaSelection.attr("font-family",fontFamilyValue)},fontSize:function(fontSizeValue){textAreaSelection.attr("font-size",fontSizeValue)},fontStyle:function(fontStyleValue){textAreaSelection.attr("font-style",fontStyleValue)},fontWeight:function(fontWeightValue){textAreaSelection.attr("font-weight",fontWeightValue)},rotation:function(rotationValue){transform+=" rotate("+rotationValue+","+(width/2-textAlignXTranslation)+","+(height/2-verticalAlignYTranslation)+")",textAreaSelection.attr("transform",transform)}},attributeList=d3.map(data).entries().sort(function(a,b){return attributeDependencyOrder.indexOf(a.key)-attributeDependencyOrder.indexOf(b.key)});attributeList.forEach(function(attributeListItem){attributeListItemName=attributeListItem.key,attributeListItemValue=attributeListItem.value,svgTextAttributeGenerator.hasOwnProperty(attributeListItemName)&&svgTextAttributeGenerator[attributeListItemName](attributeListItemValue)}),callback&&callback(textAreaSelection[0][0])}},crossPlatformText.canvas={};