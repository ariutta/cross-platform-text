window.crossPlatformText={init:function(args,callback){var crossPlatformTextInstance=this;this.svg.crossPlatformTextInstance=crossPlatformTextInstance;var format,targetSelector=args.targetSelector,target=document.querySelector(targetSelector),targetTagName=target.tagName.toLowerCase(),targetSelection=d3.select(target),htmlContainerElements=["div","section","p"];htmlContainerElements.indexOf(this.targetTagName)>-1?(format=args.format,this[format].targetSelection=targetSelection,this.setFormat(format,targetTagName,targetSelection),crossPlatformTextInstance[format].init(args,function(viewport){callback&&callback(viewport)})):(format=targetTagName,this[format].targetImageSelection=targetSelection,this.setFormat(format,targetTagName,targetSelection),this[format].init(args,function(viewport){callback&&callback(viewport)}))},setFormat:function(format,targetTagName){this[format].targetTagName=targetTagName,this.render=this[format].render}},crossPlatformText.svg={init:function(data,callback){var viewport;if(this.targetImageSelection)targetImageSelection=this.targetImageSelection,viewport=targetImageSelection.select("#viewport"),viewport[0][0]||(viewport=targetImageSelection.select("g"));else{var id=args.id||"cross-platform-text-svg";targetImageSelection=this.targetSelection.append("svg").attr("id",id).attr("version","1.1").attr("baseProfile","full").attr("xmlns","http://www.w3.org/1999/xlink").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").attr("xmlns:xmlns:ev","http://www.w3.org/2001/xml-events").attr("preserveAspectRatio","xMidYMid").attr("width",width).attr("height",height),viewport=targetImageSelection.append("g").attr("id","viewport")}callback&&callback(viewport)},render:function(data,callback){var textAnchor,textLinesX,attributeDependencyOrder=(this.crossPlatformTextInstance,["fontSize"]),translateX=data.x+data.width/2,translateY=data.y+data.height/2,transform="translate("+translateX+" "+translateY+")",textAreaSelection=targetImageSelection.select(data.containerSelector).append("g").attr("transform",transform);"left"===data.textAlign?(textAnchor="start",textLinesX=-1*data.width/2):"right"===data.textAlign?(textAnchor="end",textLinesX=data.width/2):(textAnchor="middle",textLinesX=0);var textContentSplitIntoLines=data.textContent.split(/\r\n|\r|\n|&#xA;/g),textLineCount=textContentSplitIntoLines.length,result=(textAreaSelection.selectAll("text").data(textContentSplitIntoLines).enter().append("text").attr("id",function(d,i){return"text-line"+i}).attr("x",textLinesX).attr("y",function(d,i){return 1.1*(i-(textLineCount-1)/2)+"em"}).attr("alignment-baseline",data.verticalAlign).attr("text-anchor",textAnchor).text(function(d){return d}),{}),attributes=[];result.elementName="g";var backgroundColor=data.backgroundColor||"transparent";attributes.push({name:"fill",value:backgroundColor});var color,attributeListItemName,attributeListItemValue,svgTextAttributeGenerator={id:function(idValue){textAreaSelection.attr("id","text-for-"+idValue)},fontSize:function(fontSizeValue){textAreaSelection.attr("font-size",fontSizeValue)},fill:function(fillValue){textAreaSelection.attr("fill",fillValue),attributes.push({name:"fill",value:fillValue})},fillOpacity:function(){textAreaSelection.attr("id","text-for-"+idValue)},color:function(colorValue){color=colorValue,textAreaSelection.attr("fill",colorValue)},rotation:function(rotationValue){transform+=" rotate("+rotationValue+")",textAreaSelection.attr("transform",transform)}},attributeList=d3.map(data).entries().sort(function(a,b){return attributeDependencyOrder.indexOf(a.key)-attributeDependencyOrder.indexOf(b.key)});attributeList.forEach(function(attributeListItem){attributeListItemName=attributeListItem.key,attributeListItemValue=attributeListItem.value,svgTextAttributeGenerator.hasOwnProperty(attributeListItemName)&&svgTextAttributeGenerator[attributeListItemName](attributeListItemValue)}),callback&&callback(textAreaSelection)}},crossPlatformText.canvas={};